fn @range(body: fn (i32) -> ()) {
    fn loop(a: i32, b: i32) -> () {
        if a < b {
            body(a);
            loop(a + 1, b)
        }
    }
    loop
}

#[export]
fn foo(count: i32, buf: &mut[i32]) -> i32 {
    let mut acc = 0;
    for i in range(0, count) {
        acc += buf(i);
    }
    acc
}
